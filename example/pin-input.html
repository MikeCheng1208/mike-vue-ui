<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MPinInput çµ„ä»¶ç¯„ä¾‹</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background-color: #f8fafc;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        padding: 32px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #1f2937;
        margin-bottom: 8px;
      }

      .subtitle {
        color: #6b7280;
        margin-bottom: 32px;
      }

      .demo-section {
        margin: 32px 0;
        padding: 24px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #fafbfc;
      }

      .demo-section h3 {
        margin-top: 0;
        color: #374151;
      }

      .demo-content {
        margin: 16px 0;
      }

      .info {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 6px;
        padding: 12px;
        margin: 12px 0;
        color: #0c4a6e;
      }

      .controls {
        margin-top: 16px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .controls button {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }

      .controls button:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
      }

      .controls button:active {
        transform: translateY(1px);
      }

      .status {
        margin-top: 12px;
        font-size: 14px;
        color: #6b7280;
      }

      .status.completed {
        color: #059669;
        font-weight: 500;
      }

      .custom-theme {
        --pin-input-size: 56px;
        --pin-input-gap: 12px;
        --pin-input-border-color: #e11d48;
        --pin-input-focus-color: #be185d;
        --pin-input-border-radius: 12px;
      }

      .small-theme {
        --pin-input-size: 32px;
        --pin-input-gap: 4px;
        --pin-input-font-size: 14px;
      }

      @media (max-width: 640px) {
        .container {
          padding: 16px;
        }

        .controls {
          flex-direction: column;
        }

        .controls button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <h1>MPinInput çµ„ä»¶ç¯„ä¾‹</h1>
        <p class="subtitle">
          å¯†ç¢¼è¼¸å…¥çµ„ä»¶ï¼Œæ”¯æ´è‡ªå®šç¾©é•·åº¦ã€æ™ºèƒ½ç„¦é»ç®¡ç†å’Œåˆªé™¤è¡Œç‚º
        </p>

        <!-- åŸºæœ¬ä½¿ç”¨ -->
        <div class="demo-section">
          <h3>ğŸ¯ åŸºæœ¬ä½¿ç”¨ï¼ˆé è¨­ 5 ä½æ•¸ï¼‰</h3>
          <div class="demo-content">
            <m-pin-input
              v-model="pinValue1"
              @complete="onComplete1"
              @change="onChange1"
            ></m-pin-input>
          </div>
          <div class="info">
            ç•¶å‰å€¼: <strong>{{ pinValue1 || '(ç©º)' }}</strong><br />
            ç‹€æ…‹:
            <span :class="{ completed: completed1 }"
              >{{ completed1 ? 'âœ… å·²å®Œæˆ' : 'â³ è¼¸å…¥ä¸­' }}</span
            >
          </div>
        </div>

        <!-- è‡ªå®šç¾©é•·åº¦ -->
        <div class="demo-section">
          <h3>ğŸ“ è‡ªå®šç¾©é•·åº¦</h3>
          <div class="demo-content">
            <div style="margin-bottom: 16px">
              <label>4 ä½æ•¸é©—è­‰ç¢¼ï¼š</label>
              <m-pin-input
                v-model="pinValue2"
                :length="4"
                @complete="onComplete2"
              ></m-pin-input>
            </div>
            <div>
              <label>6 ä½æ•¸å¯†ç¢¼ï¼š</label>
              <m-pin-input v-model="pinValue3" :length="6"></m-pin-input>
            </div>
          </div>
          <div class="info">
            4ä½æ•¸å€¼: <strong>{{ pinValue2 || '(ç©º)' }}</strong><br />
            6ä½æ•¸å€¼: <strong>{{ pinValue3 || '(ç©º)' }}</strong>
          </div>
        </div>

        <!-- ç¦ç”¨ç‹€æ…‹ -->
        <div class="demo-section">
          <h3>ğŸš« ç¦ç”¨ç‹€æ…‹</h3>
          <div class="demo-content">
            <m-pin-input
              v-model="pinValue4"
              :disabled="isDisabled"
            ></m-pin-input>
          </div>
          <div class="controls">
            <button @click="toggleDisabled">
              {{ isDisabled ? 'å•Ÿç”¨çµ„ä»¶' : 'ç¦ç”¨çµ„ä»¶' }}
            </button>
          </div>
          <div class="info">
            ç‹€æ…‹: {{ isDisabled ? 'å·²ç¦ç”¨' : 'å·²å•Ÿç”¨' }}<br />
            å€¼: <strong>{{ pinValue4 || '(ç©º)' }}</strong>
          </div>
        </div>

        <!-- ç¨‹å¼åŒ–æ§åˆ¶ -->
        <div class="demo-section">
          <h3>ğŸ® ç¨‹å¼åŒ–æ§åˆ¶</h3>
          <div class="demo-content">
            <m-pin-input
              ref="pinInputRef"
              v-model="pinValue5"
              @change="onChange5"
            ></m-pin-input>
          </div>
          <div class="controls">
            <button @click="setValue">è¨­å®šå€¼ "12345"</button>
            <button @click="clearValue">æ¸…ç©ºæ‰€æœ‰</button>
            <button @click="focusFirst">ç„¦é»åˆ°ç¬¬1å€‹</button>
            <button @click="focusThird">ç„¦é»åˆ°ç¬¬3å€‹</button>
            <button @click="getValue">ç²å–ç•¶å‰å€¼</button>
          </div>
          <div class="info">
            ç•¶å‰å€¼: <strong>{{ pinValue5 || '(ç©º)' }}</strong><br />
            <span v-if="lastGetValue"
              >æœ€å¾Œç²å–å€¼: <strong>{{ lastGetValue }}</strong></span
            >
          </div>
        </div>

        <!-- è‡ªå®šç¾©ä¸»é¡Œ -->
        <div class="demo-section">
          <h3>ğŸ¨ è‡ªå®šç¾©ä¸»é¡Œ</h3>
          <div class="demo-content">
            <div style="margin-bottom: 16px">
              <label>ç´…è‰²ä¸»é¡Œï¼ˆå¤§å°ºå¯¸ï¼‰ï¼š</label>
              <div class="custom-theme">
                <m-pin-input v-model="pinValue6" :length="4"></m-pin-input>
              </div>
            </div>
            <div>
              <label>å°å°ºå¯¸ä¸»é¡Œï¼š</label>
              <div class="small-theme">
                <m-pin-input v-model="pinValue7" :length="6"></m-pin-input>
              </div>
            </div>
          </div>
          <div class="info">
            ç´…è‰²ä¸»é¡Œå€¼: <strong>{{ pinValue6 || '(ç©º)' }}</strong><br />
            å°å°ºå¯¸å€¼: <strong>{{ pinValue7 || '(ç©º)' }}</strong>
          </div>
        </div>

        <!-- ä½¿ç”¨èªªæ˜ -->
        <div class="demo-section">
          <h3>ğŸ“– ä½¿ç”¨èªªæ˜</h3>
          <div class="info">
            <strong>éµç›¤æ“ä½œï¼š</strong><br />
            â€¢ æ•¸å­—éµ (0-9)ï¼šè¼¸å…¥æ•¸å­—ä¸¦è‡ªå‹•è·³åˆ°ä¸‹ä¸€æ¡†<br />
            â€¢ Backspaceï¼šåˆªé™¤ç•¶å‰æ¡†æˆ–è·³åˆ°å‰ä¸€æ¡†<br />
            â€¢ Deleteï¼šåˆªé™¤ç•¶å‰æ¡†å…§å®¹<br />
            â€¢ æ–¹å‘éµï¼šåœ¨è¼¸å…¥æ¡†é–“ç§»å‹•<br />
            â€¢ Tabï¼šæ¨™æº–ç„¦é»å°èˆª<br /><br />

            <strong>æ»‘é¼ æ“ä½œï¼š</strong><br />
            â€¢ é»æ“Šä»»æ„è¼¸å…¥æ¡†è¨­å®šç„¦é»<br />
            â€¢ æ”¯æ´æ‹–æ‹½é¸å–ï¼ˆä½†æœƒè¢«é˜»æ­¢ä»¥ä¿æŒä¸€è‡´æ€§ï¼‰<br /><br />

            <strong>æ™ºèƒ½è¡Œç‚ºï¼š</strong><br />
            â€¢ è‡ªå‹•è·³è½‰ï¼šè¼¸å…¥æ•¸å­—å¾Œè‡ªå‹•ç§»åˆ°ä¸‹ä¸€æ¡†<br />
            â€¢ æ™ºèƒ½åˆªé™¤ï¼šç©ºæ¡†åˆªé™¤æ™‚è·³åˆ°å‰ä¸€æ¡†<br />
            â€¢ è¼¸å…¥é©—è­‰ï¼šåªæ¥å—æ•¸å­—å­—ç¬¦<br />
            â€¢ å®Œæˆæª¢æ¸¬ï¼šæ‰€æœ‰æ¡†å¡«æ»¿æ™‚è§¸ç™¼å®Œæˆäº‹ä»¶
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      // å°å…¥å¯¦éš›çµ„ä»¶ï¼ˆé–‹ç™¼æ™‚ä½¿ç”¨ï¼‰
      // import { MPinInput } from '../dist/mike-vue-ui.es.js'

      // è‡¨æ™‚çµ„ä»¶å®šç¾©ï¼ˆç”¨æ–¼æ¼”ç¤ºï¼‰
      const MPinInput = {
        template: `
                 <div 
                     class="m-pin-input"
                     role="group"
                     :aria-label="\`å¯†ç¢¼è¼¸å…¥ï¼Œå…± \${length} ä½æ•¸\`"
                 >
                     <input
                         v-for="(value, index) in inputValues"
                         :key="index"
                         :ref="(el) => setInputRef(el, index)"
                         :value="value"
                         type="text"
                         inputmode="numeric"
                         autocomplete="off"
                         maxlength="1"
                         class="m-pin-input__item"
                         :class="{
                             'm-pin-input__item--focused': currentIndex === index,
                             'm-pin-input__item--filled': value !== '',
                             'm-pin-input__item--disabled': disabled
                         }"
                         :disabled="disabled"
                         :aria-label="\`ç¬¬ \${index + 1} ä½æ•¸å­—\`"
                         @input="handleInput($event, index)"
                         @keydown="handleKeydown($event, index)"
                         @focus="handleFocus(index)"
                         @click="handleClick(index)"
                     />
                 </div>
             `,
        props: {
          length: { type: Number, default: 5 },
          disabled: { type: Boolean, default: false },
          modelValue: { type: String, default: "" },
        },
        emits: ["update:modelValue", "complete", "change"],
        setup(props, { emit }) {
          const { ref, computed, nextTick, watch } = Vue;

          const inputValues = ref([]);
          const currentIndex = ref(0);
          const inputRefs = ref([]);

          const initializeValues = () => {
            inputValues.value = new Array(props.length).fill("");
            if (props.modelValue) {
              const chars = props.modelValue.split("").slice(0, props.length);
              chars.forEach((char, index) => {
                if (/^\d$/.test(char)) {
                  inputValues.value[index] = char;
                }
              });
              const nextEmptyIndex = inputValues.value.findIndex(
                (val) => val === ""
              );
              currentIndex.value =
                nextEmptyIndex === -1 ? props.length - 1 : nextEmptyIndex;
            }
          };

          const fullValue = computed(() => inputValues.value.join(""));

          watch(() => props.length, initializeValues, { immediate: true });
          watch(
            () => props.modelValue,
            (newValue) => {
              if (newValue !== fullValue.value) {
                initializeValues();
              }
            }
          );

          watch(fullValue, (newValue) => {
            emit("update:modelValue", newValue);
            if (
              newValue.length === props.length &&
              newValue.split("").every((char) => /^\d$/.test(char))
            ) {
              emit("complete", newValue);
            }
          });

          const setInputRef = (el, index) => {
            if (el) inputRefs.value[index] = el;
          };

          const focusInput = (index) => {
            if (index >= 0 && index < props.length && inputRefs.value[index]) {
              inputRefs.value[index].focus();
              currentIndex.value = index;
            }
          };

          const isValidInput = (value) => /^\d$/.test(value);

          const handleInput = (event, index) => {
            if (props.disabled) return;
            const inputValue = event.target.value;
            const lastChar = inputValue.slice(-1);

            if (lastChar && !isValidInput(lastChar)) {
              event.target.value = inputValues.value[index];
              return;
            }

            if (lastChar && isValidInput(lastChar)) {
              inputValues.value[index] = lastChar;
              emit("change", fullValue.value, index);
              if (index < props.length - 1) {
                nextTick(() => focusInput(index + 1));
              }
            } else if (inputValue === "") {
              inputValues.value[index] = "";
              emit("change", fullValue.value, index);
            }
          };

          const handleKeydown = (event, index) => {
            if (props.disabled) return;
            const { key } = event;

            if (key === "Backspace") {
              event.preventDefault();
              if (inputValues.value[index] !== "") {
                inputValues.value[index] = "";
                emit("change", fullValue.value, index);
              } else if (index > 0) {
                inputValues.value[index - 1] = "";
                emit("change", fullValue.value, index - 1);
                nextTick(() => focusInput(index - 1));
              }
              return;
            }

            if (key === "Delete") {
              event.preventDefault();
              inputValues.value[index] = "";
              emit("change", fullValue.value, index);
              return;
            }

            if (key === "ArrowLeft" && index > 0) {
              event.preventDefault();
              focusInput(index - 1);
              return;
            }

            if (key === "ArrowRight" && index < props.length - 1) {
              event.preventDefault();
              focusInput(index + 1);
              return;
            }

            if (isValidInput(key)) {
              event.preventDefault();
              inputValues.value[index] = key;
              emit("change", fullValue.value, index);
              if (index < props.length - 1) {
                nextTick(() => focusInput(index + 1));
              }
              return;
            }

            if (
              !/^(Tab|Shift|Control|Alt|Meta|CapsLock)$/.test(key) &&
              !key.startsWith("Arrow")
            ) {
              event.preventDefault();
            }
          };

          const handleFocus = (index) => {
            if (props.disabled) return;
            currentIndex.value = index;
          };

          const handleClick = (index) => {
            if (props.disabled) return;
            focusInput(index);
          };

          const focus = (index) => {
            if (typeof index === "number") {
              focusInput(index);
            } else {
              const emptyIndex = inputValues.value.findIndex(
                (val) => val === ""
              );
              const targetIndex =
                emptyIndex === -1 ? props.length - 1 : emptyIndex;
              focusInput(targetIndex);
            }
          };

          const clear = () => {
            inputValues.value = new Array(props.length).fill("");
            currentIndex.value = 0;
            nextTick(() => focusInput(0));
          };

          const getValue = () => fullValue.value;

          const setValue = (value) => {
            if (typeof value !== "string") return;
            inputValues.value = new Array(props.length).fill("");
            const chars = value.split("").slice(0, props.length);
            chars.forEach((char, index) => {
              if (isValidInput(char)) {
                inputValues.value[index] = char;
              }
            });
            const nextEmptyIndex = inputValues.value.findIndex(
              (val) => val === ""
            );
            const targetIndex =
              nextEmptyIndex === -1 ? props.length - 1 : nextEmptyIndex;
            nextTick(() => focusInput(targetIndex));
          };

          return {
            inputValues,
            currentIndex,
            setInputRef,
            handleInput,
            handleKeydown,
            handleFocus,
            handleClick,
            focus,
            clear,
            getValue,
            setValue,
          };
        },
      };

      const { createApp, ref } = Vue;

      createApp({
        components: { MPinInput },
        setup() {
          // éŸ¿æ‡‰å¼ç‹€æ…‹
          const pinValue1 = ref("");
          const pinValue2 = ref("");
          const pinValue3 = ref("");
          const pinValue4 = ref("");
          const pinValue5 = ref("");
          const pinValue6 = ref("");
          const pinValue7 = ref("");

          const completed1 = ref(false);
          const isDisabled = ref(false);
          const lastGetValue = ref("");

          const pinInputRef = ref(null);

          // äº‹ä»¶è™•ç†
          const onComplete1 = (value) => {
            completed1.value = true;
            console.log("âœ… è¼¸å…¥å®Œæˆ:", value);
            setTimeout(() => {
              completed1.value = false;
            }, 3000);
          };

          const onComplete2 = (value) => {
            console.log("âœ… 4ä½æ•¸å®Œæˆ:", value);
            alert(`4ä½æ•¸é©—è­‰ç¢¼è¼¸å…¥å®Œæˆ: ${value}`);
          };

          const onChange1 = (value, index) => {
            console.log(`ğŸ“ ç¬¬ ${index + 1} å€‹æ¡†æ”¹è®Š:`, value);
          };

          const onChange5 = (value, index) => {
            console.log(`ğŸ® ç¨‹å¼åŒ–æ§åˆ¶ - ç¬¬ ${index + 1} å€‹æ¡†æ”¹è®Š:`, value);
          };

          // æ§åˆ¶æ–¹æ³•
          const toggleDisabled = () => {
            isDisabled.value = !isDisabled.value;
          };

          const setValue = () => {
            if (pinInputRef.value) {
              pinInputRef.value.setValue("12345");
            }
          };

          const clearValue = () => {
            if (pinInputRef.value) {
              pinInputRef.value.clear();
            }
          };

          const focusFirst = () => {
            if (pinInputRef.value) {
              pinInputRef.value.focus(0);
            }
          };

          const focusThird = () => {
            if (pinInputRef.value) {
              pinInputRef.value.focus(2);
            }
          };

          const getValue = () => {
            if (pinInputRef.value) {
              const value = pinInputRef.value.getValue();
              lastGetValue.value = value || "(ç©º)";
              alert(`ç•¶å‰å€¼: ${value || "(ç©º)"}`);
            }
          };

          return {
            pinValue1,
            pinValue2,
            pinValue3,
            pinValue4,
            pinValue5,
            pinValue6,
            pinValue7,
            completed1,
            isDisabled,
            lastGetValue,
            pinInputRef,
            onComplete1,
            onComplete2,
            onChange1,
            onChange5,
            toggleDisabled,
            setValue,
            clearValue,
            focusFirst,
            focusThird,
            getValue,
          };
        },
      }).mount("#app");
    </script>

    <style>
      /* å¼•å…¥çµ„ä»¶æ¨£å¼ */
      .m-pin-input {
        --pin-input-size: 48px;
        --pin-input-gap: 8px;
        --pin-input-border-color: #d1d5db;
        --pin-input-border-width: 1px;
        --pin-input-border-radius: 6px;
        --pin-input-focus-color: #3b82f6;
        --pin-input-focus-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        --pin-input-disabled-color: #9ca3af;
        --pin-input-disabled-bg: #f9fafb;
        --pin-input-text-color: #1f2937;
        --pin-input-font-size: 18px;
        --pin-input-font-weight: 500;
        --pin-input-bg-color: #ffffff;

        display: flex;
        align-items: center;
        gap: var(--pin-input-gap);
        font-family: inherit;
      }

      .m-pin-input__item {
        width: var(--pin-input-size);
        height: var(--pin-input-size);
        border: var(--pin-input-border-width) solid
          var(--pin-input-border-color);
        border-radius: var(--pin-input-border-radius);
        background-color: var(--pin-input-bg-color);
        color: var(--pin-input-text-color);
        font-size: var(--pin-input-font-size);
        font-weight: var(--pin-input-font-weight);
        text-align: center;
        outline: none;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        -webkit-appearance: none;
        -moz-appearance: textfield;
        appearance: none;
        margin: 0;
        padding: 0;
        user-select: none;
      }

      .m-pin-input__item::-webkit-outer-spin-button,
      .m-pin-input__item::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      .m-pin-input__item:focus,
      .m-pin-input__item--focused {
        border-color: var(--pin-input-focus-color);
        box-shadow: var(--pin-input-focus-shadow);
        transform: scale(1.02);
      }

      .m-pin-input__item--filled {
        background-color: rgba(59, 130, 246, 0.05);
        border-color: var(--pin-input-focus-color);
      }

      .m-pin-input__item--disabled {
        background-color: var(--pin-input-disabled-bg);
        border-color: var(--pin-input-disabled-color);
        color: var(--pin-input-disabled-color);
        cursor: not-allowed;
        transform: none;
      }

      .m-pin-input__item--disabled:focus {
        box-shadow: none;
        transform: none;
      }

      .m-pin-input__item:hover:not(:disabled):not(:focus) {
        border-color: var(--pin-input-focus-color);
      }
    </style>
  </body>
</html>
